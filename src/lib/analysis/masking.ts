// 개인정보 마스킹 모듈 — regex 기반

/**
 * 입력 텍스트에서 개인정보를 마스킹합니다.
 * - 한국 이름 패턴 (2-4자 한글 이름)
 * - 전화번호
 * - 이메일
 * - 회사명 패턴 (주식회사, (주) 등)
 */
export function maskPersonalInfo(text: string): string {
  let masked = text;

  // 전화번호 마스킹 (010-1234-5678, 02-123-4567 등)
  masked = masked.replace(
    /(\d{2,3})[-.\s]?(\d{3,4})[-.\s]?(\d{4})/g,
    "$1-****-$3"
  );

  // 이메일 마스킹
  masked = masked.replace(
    /([a-zA-Z0-9._%+-]+)@([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g,
    "***@$2"
  );

  // 회사명 마스킹 — (주)회사명, 주식회사 회사명
  masked = masked.replace(
    /(?:\(주\)\s?|주식회사\s?)([가-힣a-zA-Z]+)/g,
    "(주)○○○"
  );

  // 한국 이름 패턴 마스킹 — "김○○", "이○○ 팀장" 등
  // 성씨 + 이름 패턴 (2-4자)
  const koreanSurnames = [
    "김", "이", "박", "최", "정", "강", "조", "윤", "장", "임",
    "한", "오", "서", "신", "권", "황", "안", "송", "류", "전",
    "홍", "고", "문", "양", "손", "배", "백", "허", "유", "남",
    "심", "노", "하", "곽", "성", "차", "주", "우", "구", "민",
    "진", "나", "변", "방", "석", "선", "설", "마", "길", "연",
  ];
  const surnamePattern = koreanSurnames.join("|");
  const nameRegex = new RegExp(
    `(?<![가-힣])(${surnamePattern})([가-힣]{1,3})(?![가-힣])`,
    "g"
  );
  masked = masked.replace(nameRegex, (match, surname: string) => {
    // 일반적인 한국어 단어와 구분하기 위한 기본 필터
    const commonWords = [
      "이사", "이상", "이후", "이전", "이유", "이것", "이런",
      "정도", "정말", "정신", "정상", "정리",
      "강요", "강제", "강압",
      "최근", "최초", "최소", "최대",
      "한번", "한동안", "한편",
      "조금", "조직", "조치",
      "장기", "장소",
      "임원", "임시",
      "권한", "권리",
      "황당",
      "안전", "안내",
      "배제", "배치",
      "허락",
      "남자", "남성", "남편",
      "심각", "심한", "심리",
      "하루", "하지", "하나",
      "구조", "구체",
      "진행", "진단", "진짜",
      "나중", "나머지",
      "변호", "변경",
      "방법", "방지",
      "석달",
      "선임", "선배",
      "설명",
      "마감", "마지막",
      "연차", "연락",
    ];
    if (commonWords.includes(match)) return match;
    return `${surname}○○`;
  });

  return masked;
}
